
# 产品需求文档 (PRD): 团队协作套件

**版本:** 1.0
**日期:** 2025年7月11日
**负责人:** (产品经理)

---

## 1. 功能概述

**功能名称:** 团队协作套件 (Team Collaboration Suite)

**目标:** 在 DjangoTestPlatform 内部构建一个围绕“测试”这一核心活动的功能闭环，使团队成员（测试、开发、产品经理）能够就测试用例、测试执行和测试报告进行高效、透明的沟通和协作，将沟通内容沉淀为知识资产。

## 2. 背景与问题陈述

当前平台提供了强大的测试用例管理和执行功能，但在团队协作方面存在空白。当测试出现问题、用例需要评审或结果需要讨论时，团队成员必须切换到外部沟通工具（如微信、Slack、邮件），导致：

- **沟通与上下文脱节:** 讨论分散在各处，无法与具体的测试用例或报告直接关联。
- **信息孤岛:** 重要的沟通记录没有在平台内沉淀，新成员难以了解历史背景。
- **协作效率低下:** 跨工具的沟通增加了沟通成本，延长了从发现问题到解决问题的周期。

## 3. 用户画像与核心场景

| 用户角色 | 核心诉求 | 典型场景 |
| :--- | :--- | :--- |
| **测试工程师 (QA)** | 快速将问题指派给开发，并追踪解决进度。 | "这个API测试失败了，我需要 `@` 相关开发人员 `张三` 来看一下失败日志和返回数据。" |
| **开发工程师 (Dev)** | 在测试上下文中直接获取问题信息，快速定位和修复。 | "我收到了一个通知，点击后直接跳转到失败的测试报告页面，看到了QA的评论和失败详情，可以立即开始调试。" |
| **测试/研发经理 (Lead)** | 了解团队在测试活动中的沟通情况和问题瓶颈。 | "我想查看某个核心模块最近所有失败测试的讨论记录，以评估问题的复杂度和影响范围。" |
| **产品经理 (PM)** | 关注重要功能的测试结果和相关讨论。 | "新版本上线前，我想订阅“支付模块”的测试报告，任何失败和讨论我都能收到通知。" |

## 4. 功能需求 (Functional Requirements)

### 4.1. 核心功能：评论与讨论

- **评论对象:**
    - **测试用例 (TestCase):** 允许在每个测试用例详情页下进行评论，用于讨论用例设计、前置条件等。
    - **测试报告 (TestReport):** 允许在每个测试报告详情页下进行评论，用于讨论测试结果、分析失败原因。
- **评论功能:**
    - 支持富文本格式（加粗、斜体、代码块、引用）。
    - 支持 `@提及` 功能，输入`@`后可搜索并选择平台内的用户。
    - 评论可被编辑和删除（仅限作者或管理员）。
    - 评论线程式展示，支持对特定评论进行回复。

### 4.2. 核心功能：通知中心

- **通知触发器:**
    - 当用户被 `@提及` 时。
    - 当用户创建的评论/主题被他人回复时。
    - (可选) 当用户订阅的测试用例/测试计划被执行并生成报告时。
- **通知形式:**
    - 在平台右上角导航栏增加一个“铃铛”图标作为通知中心入口，未读消息以红点提示。
    - 点击通知可直接跳转到相关的测试用例或测试报告页面，并高亮显示相关评论。
- **通知管理:**
    - 通知列表分为“未读”和“全部”。
    - 支持将单条通知标记为已读或一键全部已读。

### 4.3. 关联模块的UI/UX调整

- **测试用例页 (`TestCasePage.jsx`):**
    - 在页面下方或侧边栏增加一个“讨论”区域，用于展示和发表评论。
- **测试报告页 (`TestReportPage.jsx`):**
    - 在报告详情下方增加“评论区”，用于团队沟通。
- **用户模型 (`user_management/models.py`):**
    - 无需大改，但需要能支持API查询用户列表以实现 `@提及` 功能。

## 5. 后端/API需求

- 需要新建一个 `comments` Django App。
- **`Comment` 模型:**
    - `content` (TextField): 评论内容。
    - `author` (ForeignKey to User): 评论作者。
    - `timestamp` (DateTimeField): 创建时间。
    - `parent_comment` (ForeignKey to self): 用于实现评论回复。
    - `content_type` (ForeignKey to ContentType): 关联到 `TestCase` 或 `TestReport`。
    - `object_id` (PositiveIntegerField): 关联对象的ID。
- **API Endpoints:**
    - `POST /api/comments/`: 创建新评论。
    - `GET /api/comments/?target_type=<type>&target_id=<id>`: 获取某个对象的所有评论。
    - `PUT /api/comments/<comment_id>/`: 修改评论。
    - `DELETE /api/comments/<comment_id>/`: 删除评论。
    - `GET /api/users/search/?q=<query>`: 搜索用户列表，用于 `@提及`。
- **`Notification` 模型:**
    - `recipient` (ForeignKey to User): 通知接收者。
    - `actor` (ForeignKey to User): 触发通知的用户。
    - `verb` (CharField): 动作描述 (e.g., "评论了", "提及了你")。
    - `target` (GenericForeignKey): 关联到 `Comment` 或其他对象。
    - `read` (BooleanField): 是否已读。
- **API Endpoints:**
    - `GET /api/notifications/`: 获取当前用户的通知。
    - `POST /api/notifications/mark-as-read/`: 标记通知为已读。

## 6. 非功能性需求

- **性能:** 评论和通知的加载不应阻塞主页面（可采用异步加载）。
- **安全性:** 所有评论内容需做防XSS处理，所有API请求需经过权限验证。

## 7. 成功指标 (Success Metrics)

- **活跃度:** 每日/每周的评论数量。
- **采用率:** 使用 `@提及` 功能的评论占比。
- **用户反馈:** 通过用户调研，了解新功能是否提升了团队沟通效率。

---
